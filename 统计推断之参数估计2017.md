##统计推断的思想：
由从总体中随机抽样得到的样本的数据，计算样本的统计量，再推断表征总体特征的参数。

##参数估计的方法

- 点估计(point estimation)用样本统计量来估计总体参数
- 区间估计(interval estimation)存在包含样本统计量在内的一个置信区间，该区间被认为很可能覆盖总体参数。

##区间估计的主要形式
区间估计的最普遍形式是：

- 置信区间(confidence intervals)-频率方法;
- 可信区间(credible intervals)-贝叶斯方法。

统计学理论所涵盖的区间估计的其他常用方法是：

- 公差区间 (Tolerance intervals)
- 预测区间(Prediction intervals )- 主要用于回归分析
- 似然区间(Likelihood intervals)

## 置信区间
在统计学中，置信区间（confidence interval, CI）是对总体参数的一种区间估计。它是观察到的区间（即根据观察值计算得到的区间） , 它随着样本的不同而不同，但可能包括(覆盖)不可观测的真实的总体参数。 如果重复实验，观察到的区间包含真实参数的频率称为置信水平。 换句话说，如果对一个总体很多次单独实验用相同的过程构建置信区间，则包含该参数的真实值的区间的比例将趋近于置信水平。 
维基百科的解释：https://en.wikipedia.org/wiki/Confidence_interval
耶鲁大学的解释：http://www.stat.yale.edu/Courses/1997-98/101/confint.htm
参见动画：
http://students.brown.edu/seeing-theory/statistical-inference/index.html#first

## 正态总体均值的置信区间估计
###单个正态总体均值的置信区间
正态性检验有两类方法：
- 绘图法，画直方图和qq图
- 样本统计量检验
检查某随机变量是否是正态分布。用统计检验的说，原假设及虚无假设是该变量的分布与正态分布没有显著差异。
```r
hist(x,breaks=15,prob=T);lines(density(x))
qqnorm(x);qqline(x)
# 常用shapiro检验
shapiro.test(x)
# Kolmogorov-Smirnov检验,需要给定均值和标准差
ks.test(x, "pnorm", mean, sd)
# 不设定均值和标准差，会被设定为与标准正态分布比较
x=rnorm(1000,4,2);ks.test(x, "pnorm")
ks.test(x, "pnorm",4,2)
```
http://stackoverflow.com/questions/26715843/kolmogorov-smirnov-test-in-r
Kolmogorov-Smirnov检验可以用来检验两个随机变量是否分布相同、某个变量是否是特定参数的分布（本例）等，但据说ks检验的功效power比较低，不太容易检测出非正态。

## 正态总体均值的置信区间估计
###单个正态总体均值的置信区间
1. 总体标准差未知，用$t$分布估计
$(\bar{X}-t_{\frac{\alpha}{2}}\frac{s}{\sqrt{n}}, \bar{X}+t_{\frac{\alpha}{2}}\frac{s}{\sqrt{n}})$(双侧检验)
2. 总体标准差已知，用$z$分布估计
$(\bar{X}-z_{\frac{\alpha}{2}}\frac{\sigma}{\sqrt{n}}, \bar{X}+z_{\frac{\alpha}{2}}\frac{\sigma}{\sqrt{n}})$(双侧检验)

注：这两种情况下，置信区间是以样本均值为中心的对称区间。但并不是所有置信区间都是关于样本均值对称的，例如单侧检验时、二项检验时等。

### 几个常见的符号与概念
注：在统计学中常将$z_\alpha,t_\alpha$记为$z$分布和$t$分布的上分位数。即随机变量$\ge$该值的概率（也称右尾概率）等于$\alpha$。我们可以将$t_\alpha$称为右尾概率为$\alpha$的$t$值。由于分布是对称的，而且经常做双侧检验，所以经常用到的是$z_{\frac{\alpha}{2}},t_{\frac{\alpha}{2}}$即右尾概率是$\frac{\alpha}{2}$的$z$值，$t$值。

- $\alpha$称为显著性水平，也就是假设检验中原假设($H_0$)为真但是错误地拒绝的概率。
- $1-\alpha$称为置信度或置信水平(confident level)， 它表示当假设检验中原假设($H_0$)为真时，从总体中很多次独立随机抽样，这些样本计算的置信区间覆盖真值的概率。
- $p- $值（p-value）就是当原假设($H_0$)为真时，得到目前样本观测值或与备择假设方向一致的更极端结果出现的概率。

## 两个独立正态总体均值差的置信区间
```r
# 计算x和y两个总体之间的均值差的置信区间
t.test(x, y)$conf.int
# 设定方差相同var.equal =T
t.test(x, y, var.equal =T)$conf.int
```
注：两总体均值差的置信区间的计算公式分为方差相同和方差不同两种情况，方差不齐时，计算公式更为复杂。然而，更为科学。因此R语言默认使用方差不齐的公式，你也没必要改。

## 成对正态总体均值差的置信区间
配对分两种情况：（1）一个群体在采取措施之前与之后的配对，如治疗前后等，处理方法就是将配对的差值作为一个样本，求单样本的置信区间；（2）背景相似的个体间配对，如孪生子配对。
```r
# 计算x和y两个配对总体之间的均值差的置信区间
t.test(x, y, pair=T)$conf.int
# 设定置信水平conf.level = 0.99
t.test(x, y, pair=T, conf.level = 0.99)$conf.int
```
`t.test()`可用`conf.level = `来设置置信水平。

## 比例的置信区间
### 单个总体比例的置信区间
有3个函数可用于比例的CI计算，分别是`binom.test(),Hmisc`包的`binconf()`和`binom包`的`binom.confint()`
```r
# 精确CI
binom.test(x,n,conf.level=0.95)$conf.int
# 三种CI计算方法
Hmisc::binconf(x,n,alpha=0.05, method="all")
# 用于p接近于0或1，或者样本量较小
binom::binom.confint(x,n,method="ac")
```
### 正态近似公式及样本量估计
当样本量$n$很大且样本比例$\hat{p}$不能离0或者1太近时，有近似正态公式：
$(\hat{p}-z_{\frac{\alpha}{2}}{\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}}, \hat{p}+z_{\frac{\alpha}{2}}{\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}})$
该公式目前主要用于估计调查时所需的样本量:
边际误差：$m={\sqrt{\frac{\hat{p}(1-\hat{p})}{n}}}$
样本量估计值：$n=\hat{p}(1-\hat{p})(\frac{z_{\frac{\alpha}{2}}}{m})^2$保险做法$\hat{p}=0.5$

### 两个总体比例之差的置信区间
计算两个比例之差的置信区间没有精确公式可用，但有多个近似公式。较常见的是卡方近似公式和正态近似公式。`prop.test()`使用卡方近似公式。
```r
# 第一参数是分子向量，第二参数是分母向量
prop.test(c(x1,x2),c(n1,n2), conf.level=0.95)$conf.int
```

##第六讲：统计推断 II：估计 – 置信区间
Statistical Inference: Estimation – confidence interval

置信区间
点估计的精确程度是由参数区间估计的宽度来体现的。
区间估计是以点估计为中心的一个区间。
它被设计用来以某一选定的、接近于1的概率包含参数值。
这个概率是我们信心的大小。
区间估计以某一特定置信度包含参数值，所以常常被称为置信区间。

置信区间的定义
置信区间的构建
抽样分布一般都近似的服从正态分布。
正态分布可以进而决定估计值落入某参数某一段距离内的概率究竟是多少。
置信水平95% → 估计值会落入距离真实值两个标准误的范围内。
我们几乎可以确定，估计值会落入距离真实值3个标准差的范围内。

 
总体比例的置信区间
对于分类变量，观测值的可能取值为该变量的几种可能类别。
它可能是
名义变量：民族、政治面目；
定序变量：对事情的看法、态度。
连续型变量重新分组后的某个组别：年龄组、收入。 
对分类变量进行总结时，我们关注每个类别的占比。

样本比例的均值和标准误
大样本条件下比例的置信区间
变量是离散型变量 → 二分变量，我们需要中心极限定理。
服从正态分布的变量有95%的观测值会落入距离均值2倍标准差，更精确的说，1.96倍标准差的范围内。

问题：  的取值？
 
控制置信水平
 
要把置信区间理解成一系列长期重复抽样的结果
由某一个样本获得的置信区间可能包含真实值，也可能恰好不包含。
但是重复操作很多次，构建了多个置信区间后，这些置信区间中的95%可以包含，而5%会错过。
在实际应用中，我们仅抽样一次，我们用一个固定样本量构建1个置信区间。
我们并不能确定这个置信区间到底是否涵盖了真值，但我们可以控制相信的程度。95%？ 99%？

构建样本比例置信区间时的样本量问题
我们希望样本量越大越好：样本量越大，抽样分布就越接近正态，我们用样本比例替代总体比例计算出的标准误也更接近真实的标准误。
多大的样本算大？
一般要求每个分类中至少有15个观测值。
如果不能满足，非参数方法。

比例的置信区间总结
总体均值的置信区间
 
总体均值置信区间的构建
 
以美国综合社会调查GSS为例
调查人员会询问访谈对象自他们年满18岁以后有过多少性伴侣。在2006年的那次调查中，通过231名年龄在20到29岁间的女性的回答分析，性伙伴数量的均值为4.96。你现在看到的是通过统计软件对这个变量做基本的描述分析后的结果。



 
       - 分布
对于任何样本量都适用的置信区间
此时需要增加一个假设 → 总体要服从正态分布。
这时，即使没有中心极限定理，样本均值的抽样分布也会是正态分布。

 
用样本标准差取代总体标准差
使用估计标准误，就不可避免的引入了额外的误差。
当样本量相对较小时，这个额外的误差很可能是不能忽视的。
于是置信区间就要变宽，要用一个稍大一些的数代替z得分。这就是t得分，t-score 。
t-score来自于t分布，这是个分布和正态分布很像，只是离散程度稍大。
      - 分布的性质
正态的、钟形的
它的标准差稍大于1
它的形状仅由一个参数决定，叫做自由度，degree of freedom，用df来表示。
Df=n-1。自由度不同时，t分布的形状略有改变。
随着df增大，t分布越来愈趋近于标准正态分布。当自由度大于30时，两种分布形状基本一致。
总体均值的置信区间中的边际误差是由t score乘以估计标准误得到的。








> Written with [StackEdit](https://stackedit.io/).